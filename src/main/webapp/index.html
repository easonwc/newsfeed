<!DOCTYPE html>
<html>
    <head>
        <title>News Feed</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <link rel="stylesheet" href="css/news.css">
        <link rel="stylesheet" href="//code.jquery.com/ui/1.12.0/themes/base/jquery-ui.css">
        <script src="js/jquery-3.1.0.min.js"></script>
        <script src="https://code.jquery.com/ui/1.12.0/jquery-ui.js"></script>
        <script>
            $(function () {
                $("#datepicker").datepicker();
            });
        </script>
        <script type="text/javascript">
            $(document).ready(function () {

                populateNews();

                $("#newsSubmit").click(function () {
                    submitNewNews();
                });

            });

            function submitNewNews() {

                var currentDate = $("#datepicker").datepicker("getDate");

                $.ajax({
                    type: "POST",
                    url: "InsertNewsServlet",
                    async: false,
                    dataType: "json",
                    data: {newsDate: currentDate, newsData: $("#newsText").val()}
                })
                        .done(function (data) {
                            if (data.status === "success") {
                                $("#statusNotification").html(data.newsID);

                                $("#newsText").val("");
                                populateNews();
                            } else {
                                $("#statusNotification").text(data.errorMessage);
                            }
                        });
            }

            function populateNews() {
                $.ajax({
                    type: "GET",
                    url: "GetAllNewsServlet",
                    async: false,
                    dataType: "html"
                })
                        .done(function (data) {
                            $("#newsTable").html(data);
                        });
            }

            setInterval(populateNews, 5000);
        </script>
    </head>
    <body>
        <div>
            <table id="newsTable" class="mainNewsTable">
            </table>
        </div>
        <hr/>
        <div>
            <textarea class="largeInput" name="newsText" id="newsText"></textarea>
            <p>Date: <input type="text" id="datepicker"></p>
            <button id="newsSubmit" type="button">Add News</button>
        </div>
        <div>
            <p id="statusParagraph"></p>
        </div>
    </body>
</html>
